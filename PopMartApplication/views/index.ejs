<%- include("partials/header", { title: "Marketplace - Listings" }) %>

<div class="card">
  <h2>Product / Service Listings</h2>
  <p class="muted">
    Browse listings. Click “View Details” to see more information and purchase using MetaMask.
  </p>

  <div class="alert">
    <b>Blockchain features:</b> Payments are held in escrow and only released after delivery confirmation.
    Ratings can only be submitted after a successful purchase.
  </div>
</div>

<br/>

<div class="grid">
  <% for (let i = 0; i < products.length; i++) { %>
    <div
      class="card product-card"
      data-product-id="<%= products[i].id %>"
      data-seller-address="<%= products[i].sellerAddress || '' %>"
    >
      <img class="img" src="<%= products[i].image %>" alt="image"/>
      <h3 style="margin:10px 0 6px;"><%= products[i].name %></h3>
      <div class="row">
        <span class="pill"><%= products[i].category %></span>
        <span class="pill">Seller: <%= products[i].sellerName %></span>
      </div>
      <p class="muted" style="margin:10px 0;"><%= products[i].shortDesc %></p>
      <p><b>Price:</b> <span class="mono"><%= products[i].priceEth %> ETH</span></p>
      <div class="row" style="margin:6px 0 10px;">
        <span class="stars">
          <span class="star">★</span>
          <span class="star">★</span>
          <span class="star">★</span>
          <span class="star">★</span>
          <span class="star">★</span>
        </span>
        <span class="stars-note">Rating unavailable</span>
      </div>

      <div class="row">
        <a class="btn" href="/product/<%= products[i].id %>" style="text-decoration:none; display:inline-block;">
          View Details
        </a>
      </div>
    </div>
  <% } %>
</div>

<%- include("partials/footer", { script: [
  "https://cdn.jsdelivr.net/npm/web3@4.16.0/dist/web3.min.js",
  "/js/listingsRatings.js"
] }) %>
