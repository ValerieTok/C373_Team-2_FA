<%- include("partials/header", { title: "Seller Dashboard" }) %>

<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:14px; flex-wrap:wrap; gap:10px;">
  <span class="role-tag">Seller dashboard</span>
  <div class="card" style="padding:10px 14px; border-radius:14px;">
    <span class="muted">Earnings released</span>
    <div class="mono" style="font-size:16px;"><%= earningsEth.toFixed(2) %> ETH</div>
  </div>
</div>

<div class="grid">
  <section class="card fade-in">
    <h2 style="margin-top:0;">List a Product</h2>
    <p class="muted">Add a new listing that appears on the marketplace.</p>
    <form action="/seller/listings" method="POST" class="stack" enctype="multipart/form-data">
      <input type="text" name="name" placeholder="Product name" required />
      <input type="text" name="category" placeholder="Category" required />
      <input type="number" name="priceEth" step="0.01" min="0" placeholder="Price in ETH" required />
      <input type="file" name="imageFile" accept="image/*" required />
      <input type="text" name="shortDesc" placeholder="Short description" required />
      <button class="btn btn-alt" type="submit">Publish Listing</button>
    </form>
  </section>

  <section class="card fade-in">
    <h2 style="margin-top:0;">Your Listings</h2>
    <p class="muted">Check how your products appear on the marketplace.</p>
    <div class="list">
      <% products.forEach(function(product) { %>
        <div class="list-item">
          <img class="thumb" src="<%= product.image %>" alt="Product image" />
          <div class="stack">
            <strong><%= product.name %></strong>
          <span class="mono"><%= product.priceEth %> ETH</span>
          </div>
        </div>
      <% }) %>
    </div>
  </section>
</div>

<section class="card fade-in" style="margin-top:18px;">
  <h2 style="margin-top:0;">Orders to Fulfill</h2>
  <p class="muted">View incoming orders and confirm shipment when you ship.</p>
  <p class="muted" style="margin-bottom:12px;">Latest orders are shown below.</p>
  <div class="list">
    <% if (!orders.length) { %>
      <p class="muted">No orders yet.</p>
    <% } %>
    <% orders.forEach(function(order) { %>
      <div class="card" style="margin-bottom:12px;">
        <div class="list-item">
          <img class="thumb" src="<%= order.image || '/images/popmart1.png' %>" alt="Product image" />
          <div class="stack">
            <strong>Order <%= order.id %></strong>
            <span class="muted"><%= order.productName %> x <%= order.qty %></span>
            <span class="muted">Buyer: <%= order.buyerName %></span>
            <span class="muted">Ship to: <%= order.buyerAddress %></span>
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
              <span class="pill"><%= order.category %></span>
              <span class="badge">Status: <%= order.status %></span>
              <span class="mono"><%= order.priceEth %> ETH</span>
              <span class="pill">Escrow ID: <%= order.escrowOrderId || "Pending" %></span>
            </div>
            <div class="timeline">
              <div class="timeline-item">
                Order placed: <span class="mono"><%= order.createdAtDisplay %></span>
              </div>
              <div class="timeline-item">
                Shipment confirmed: <span class="mono"><%= order.shippedAtDisplay %></span>
              </div>
              <div class="timeline-item">
                Delivery confirmed: <span class="mono"><%= order.deliveredAtDisplay %></span>
              </div>
              <div class="timeline-item">
                Payment released: <span class="mono"><%= order.releasedAtDisplay %></span>
              </div>
            </div>
            <form action="/seller/orders/<%= order.id %>/ship" method="POST" data-escrow-action="ship" data-escrow-order-id="<%= order.escrowOrderId || '' %>" data-expected-wallet="<%= order.sellerWallet || '' %>">
              <button class="btn btn-alt" type="submit" <%= order.status !== "Awaiting Shipment" ? "disabled" : "" %>>
                Confirm shipment
              </button>
            </form>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
</section>

<%- include("partials/footer") %>
